<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Getting started with ensure • ensure</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Getting started with ensure">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">ensure</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.0.1</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="active nav-item"><a class="nav-link" href="../articles/ensure.html">Get started</a></li>
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/simonpcouch/ensure/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>Getting started with ensure</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/simonpcouch/ensure/blob/main/vignettes/ensure.Rmd" class="external-link"><code>vignettes/ensure.Rmd</code></a></small>
      <div class="d-none name"><code>ensure.Rmd</code></div>
    </div>

    
    
<p>The ensure package provides an addin for drafting testthat unit
testing code using LLMs. Triggering the addin will open a corresponding
test file and begin writing tests into it. The <em>ensurer</em> is
familiar with testthat 3e as well as tidy style, and incorporates
context from the rest of your R package to write concise and relevant
tests.</p>
<div class="section level2">
<h2 id="usage">Usage<a class="anchor" aria-label="anchor" href="#usage"></a>
</h2>
<p>To use the ensurer, just trigger the addin (optionally selecting some
code to only write tests for a certain portion of the file) and watch
your testing code be written.</p>
<p><img src="https://raw.githubusercontent.com/simonpcouch/ensure/refs/heads/main/inst/figs/ensure.gif" alt="A screencast of an RStudio session, where the user has a source file open. Several functions in the source file are selected and a keyboard shortcut is pressed, at which point a corresponding test file is created and drafts of unit tests are streamed into the file."></p>
<p>To get to this point, though, you’ll need to choose a model and
register the package’s addin to a keyboard shortcut.</p>
</div>
<div class="section level2">
<h2 id="choosing-a-model">Choosing a model<a class="anchor" aria-label="anchor" href="#choosing-a-model"></a>
</h2>
<p>The ensure addin supports any model supported by <a href="https://ellmer.tidyverse.org/" class="external-link">ellmer</a>. When choosing a model
for use with ensure, you’ll want to the use the most performant model
possible that satisfies your privacy needs; ensure automatically passes
along your code to your chosen model, so it’s especially important to
consider data privacy when using LLMs with ensure.</p>
<p>ensure uses the <code>.ensure_fn</code> and <code>.ensure_args</code>
options to configure which model powers the addin.
<code>.ensure_fn</code> is the name of an ellmer <code>chat_*()</code>
function as a string, and <code>.ensure_args</code> is a list of
arguments to pass to that function. For example, to use OpenAI’s
GPT-4o-mini, you might write
<code>options(.ensure_fn = "chat_openai", .ensure_args = list(model = "gpt-4o-mini"))</code>.
Paste that code in your <code>.Rprofile</code> via
<code><a href="https://usethis.r-lib.org/reference/edit.html" class="external-link">usethis::edit_r_profile()</a></code> to always use the same model
every time you start an R session.</p>
<p>If you’re using ellmer inside a organization, you’ll be limited to
what your IT department allows, which is likely to be one provided by a
big cloud provider, e.g. <code>chat_azure()</code>,
<code>chat_bedrock()</code>, <code>chat_databricks()</code>, or
<code>chat_snowflake()</code>. If you’re using ellmer for your own
exploration, you’ll have a lot more freedom, so we have a few
recommendations to help you get started:</p>
<ul>
<li><p>As of early 2025, Anthropic’s <strong>Claude Sonnet 3.5</strong>
is a very powerful model for code assistance, and thus
<code>chat_claude()</code> is the default model supported by ensure. If
you want to use Claude, you’ll need to register an <a href="https://console.anthropic.com/" class="external-link">API key</a> to the environment
variable <code>ANTHROPIC_API_KEY</code>. No need to set the
<code>.ensure_*</code> options in this case.</p></li>
<li><p>Regarding OpenAI’s models, <code>chat_openai()</code> defaults to
<strong>GPT-4o</strong>, but you can use
<code>model = "gpt-4o-mini"</code> for a cheaper, lower-quality model,
or <code>model = "o1-mini"</code> for more complex reasoning; to use an
OpenAI model, you’ll need to set the options
<code>options(.ensure_fn = "chat_openai", .ensure_args = list(model = "gpt-4o-mini"))</code>
and register your OpenAI API key with the <code>OPENAI_API_KEY</code>
environment variable.</p></li>
<li><p>You can use a <strong>local model</strong> with
<code>chat_ollama()</code>, which uses <a href="https://ollama.com" class="external-link">Ollama</a> and allows you to run models on
your own computer. While the biggest models you can run locally aren’t
as good as the state of the art hosted models, they don’t share your
data and are effectively free. To use an ollama model, run the model
locally and then set
<code>options(.ensure_fn = "chat_ollama", .ensure_args = list(model = "model-name"))</code>.</p></li>
</ul>
</div>
<div class="section level2">
<h2 id="registering-a-keyboard-shortcut">Registering a keyboard shortcut<a class="anchor" aria-label="anchor" href="#registering-a-keyboard-shortcut"></a>
</h2>
<p>The ensurer is interfaced with the via the RStudio addin “ensure:
Test R code.” For easiest access, we recommend registering the ensure
addin to a keyboard shortcut. <strong>In RStudio</strong>, navigate to
<code>Tools &gt; Modify Keyboard Shortcuts &gt; Search "ensure"</code>—we
suggest <code>Ctrl+Alt+T</code> (or <code>Ctrl+Cmd+T</code> on macOS).
The ensurer is currently not available in Positron as Positron has yet
to implement document <code>id</code>s that the package needs to toggle
between source and test files.</p>
</div>
<div class="section level2">
<h2 id="tips-and-tricks">Tips and tricks<a class="anchor" aria-label="anchor" href="#tips-and-tricks"></a>
</h2>
<p>Knowing a few pieces about how ensure works will help you use it
effectively:</p>
<ul>
<li><p>The model is provided with the current contents of your test
file. If you find the model is having trouble initializing objects from
your package in a reasonable way, write one test in the test file
yourself; many models will pattern-match based on your existing
code.</p></li>
<li><p>You can test as short of selections of code as you please. Rather
than testing whole source files, start off with testing single functions
or even single lines of code. Generating tests, editing them to your
taste, and <em>then</em> generating tests for new pieces code will give
the model a chance to adapt to your style of testing.</p></li>
</ul>
<!-- TODO: actually do this --><ul>
<li>The model is provided with the contents of your introductory
vignette (based on the same rules that pkgdown uses to place a “Get
Started” entry in your navbar). If knowing the basics of using your
package would be helpful context for drafting unit tests, write that
vignette!</li>
</ul>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by Simon Couch.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.1.</p>
</div>

    </footer>
</div>





  </body>
</html>
